---
layout: page
title: "Crontab"
category: scheduled-jobs
date: 2017-02-23 18:29:32
---

# Using crontab

This project contains *tasks.cron* file that is used to add cronjobs. It is automatically imported into cronjobs on container startup and compatible with normal crontab syntax.

Crontab can't be used along wp_cron so you have to disable it by adding `define('DISABLE_WP_CRON', false);` in  your *wp-config.php*.

Our docker-wordpress-server container uses cronlock binary. It uses REDIS_HOST enviroment variable by default. If you wan't to use different Redis set variables *CRONLOCK_HOST, CRONLOCK_AUTH, CRONLOCK_PORT*.

**IMPORTANT NOTE!**
Please make sure there is a blank line after the last cronjob entry.

## Running wp cli
Cause crontab doesn't have PATH variable defined we can't run WP-CLI by just `wp` command but we have to use `/usr/local/bin/wp` instead.

Example:
Use `wp eval` to call fetchRSS(); after every ten minutes.
```
*/10 * * * * /usr/local/bin/wp eval 'RSSFetcher::fetchRSS();'
```
Handy tool for cronjob timing: https://crontab.guru


## Testing
A handy way to test cron is to update transient with current Unix timestamp in every minute.
```
* * * * *  /usr/local/bin/wp eval 'set_transient( "cron_test", microtime(), HOUR_IN_SECONDS );
```
Then you can run to see if the transient updates.

```
wp eval 'echo get_transient("cron_test");'
```

## Prevent mails
Add this to top of the file to prevent cron sending mail for each run job.
```
MAILTO=""
```
