web:
  image: devgeniem/alpine-wordpress:latest
  ports:
    - 80
  links:
    - db
    - redis
  volumes:
    - .:/data/code
    - ./.docker/log:/data/log
    # In production uploads will be in /data/uploads/
    # This way let the container see them like in production
    - ./.docker/uploads:/data/uploads
  environment:
    # Small variable to tell if we are in production,testing or development
    # Don't use this in your code unless this is only option
    # We want to nearly identical codebase in production and development
    WP_ENV: development

    # Set php to use redis for object cache & sessions
    PHP_SESSION_HANDLER: redis
    PHP_SESSION_REDIS_DB: 0
    WP_REDIS_DATABASE: 1

    # These will be mapped automatically in development to jwilder/nginx-proxy
    VIRTUAL_HOST:  wordpress.test
    HTTPS_HOST: wordpress.test

    # Set project WP_SITEURL & HOME
    WP_SITEURL: https://wordpress.test
    WP_HOME: https://wordpress.test

    DB_NAME: wordpress
    DB_USER: wordpress
    DB_PASSWORD: wordpress
    SMTP_FROM: no-reply@wordpress.test
  dns:
    # We need to add this static ip here until we can add --dns flag in nlf/dlite
    # Related issue: https://github.com/nlf/dlite/issues/90
    - 172.17.0.1
    - 127.0.0.1
db:
  image: devgeniem/mariadb-galera:rsync
  volumes:
    # Make database persistent
    - /var/lib/mysql
  environment:
    BOOTSTRAP: "on"
    MYSQL_DATABASE: wordpress
    MYSQL_USER: wordpress
    MYSQL_PASSWORD: wordpress
    MYSQL_ROOT_PASSWORD: root

redis:
  image: redis
